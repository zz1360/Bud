# **文件存储专题**

#### 5.8.1 介绍

在实际开发中，我们会有很多处理不同功能的服务器。例如：

应用服务器：负责部署我们的应用

数据库服务器：运行我们的数据库

文件服务器：负责存储用户上传文件的服务器

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image002.gif)

分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。常见的图片存储方案：

方案一：使用nginx搭建图片服务器

方案二：使用开源的分布式文件存储系统，例如Fastdfs、HDFS等

方案三：使用云存储，例如阿里云、七牛云等

#### 5.8.2 七牛云存储

##### 5.8.2.1 七牛云简介

七牛云（隶属于上海七牛信息技术有限公司）是国内领先的以视觉智能和数据智能为核心的企业级云计算服务商，同时也是国内知名智能视频云服务商，累计为 70 多万家企业提供服务，覆盖了国内80%网民。围绕富媒体场景推出了对象存储、融合 CDN 加速、容器云、大数据平台、深度学习平台等产品、并提供一站式智能视频云解决方案。为各行业及应用提供可持续发展的智能视频云生态，帮助企业快速上云，创造更广阔的商业价值。

官网：https://www.qiniu.com/

通过七牛云官网介绍我们可以知道其提供了多种服务，我们主要使用的是七牛云提供的**对象存储服务**来存储图片。

##### 5.8.2.2 七牛云使用步骤

要使用七牛云的服务，首先需要**注册**成为会员。地址：https://portal.qiniu.com/signup，然后**登录**

登录成功后点击页面右上角管理控制台：注意：登录成功后还需要进行实名认证才能进行相关操作。

要进行图片存储，我们需要在七牛云管理控制台**新建存储空间**。点击管理控制台首页对象存储下的立即添加按钮，页面跳转到新建存储空间页面，可以创建多个存储空间，各个存储空间是相互独立的。

存储空间创建后，会在左侧的存储空间列表菜单中展示创建的存储空间名称，点击存储空间名称可以**查看当前存储空间的相关信息**

可以通过七牛云提供的开发者中心学习如何操作七牛云服务，地址：https://developer.qiniu.com/

点击对象存储，跳转到对象存储开发页面，地址：https://developer.qiniu.com/kodo

七牛云提供了多种方式操作对象存储服务，传智健康项目**采用Java SDK方式**，地址：https://developer.qiniu.com/kodo/sdk/1239/java

使用Java SDK操作七牛云需要导入maven坐标。

#### 5.8.3 Fastdfs文件服务器

##### 5.8.3.1 Fastdfs简介

FastDFS是用c语言编写的一款开源的分布式文件系统。为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制。FastDFS适合存储用户上传的文件，比如用户照片。如果只是存储网站的静态文件（如装饰图片、css、js等），那没有必要使用FastDFSfastDFS。架构图（了解）

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg)

Tracker：管理storage存储服务器的状态，根据状态决定图片存放在那台服务器，以及取图片时从哪台服务器上取。

​    Storage群：会有多个组（卷）实现集群，组与组之间存储不同的图片。组内会有多台

storage存储服务器，通过同步来存储相同的图片，以实现高可用。

##### 5.8.3.2文件上传及下载的流程（面试问原理可以据此回答）

流程：

client上传或下载图片请求tracker接收请求，根据storage集群里服务器的状态选择一台并将服务器地址交给clientclient访问返回的服务器地址，实现图片的上传或下载。

流程图如下

上传流程：

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

 

 

下载流程：

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg)

 

图片在服务器上的存储路径（访问方式:http服务器地址+端口号+存储路径）

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg)

#### 5.8.4 常见面试题

##### 5.8.4.1 使用FastDFS的好处是什么？

FastDFS相比其它的分布式文件系统它适用小文件存储，它不对文件进行分块存储，也不用对文件进行合并处理，所以性能比GFS、HDFS等通用文件系统的性能要高。

##### 5.8.4.2 文件服务器的使用场景

传智健康项目：在预约管理模块中的套餐管理，使用七牛云存储服务器存储体检套餐的图片

电商项目：使用fastdfs存储商品的图片（因为图片众多，几十万上百万了，这里也可以用七牛云，不必拘泥）

##### 5.8.4.3 FastDFS支持断点续传吗？

FastDFS支付断点续传，在Api中有append_ﬁle1方法就是用来实现断点续传的，本项目没有使用FastDFS的断点续传功能。