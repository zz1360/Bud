# **MongoDB专题**

#### 5.7.1 概念

MongoDB 是由C++语言编写的，不支持sql，但有自己强大的查询语法。是一个基于分布式文件存储的开源数据库系统。MongoDB使用BSON（key=>value）作为数据存储结构和传输的格式。BSON是一种类似JSON的二进制序列化文档，支持嵌套对象和数组(相当于JSON多了date类型和二进制数组)。

在mongodb中是通过数据库、集合、文档的方式来管理数据，下边是mongodb与关系数据库的一些概念对比：

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg)

 

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image004.gif)

1、一个mongodb实例可以创建多个数据库

2、一个数据库可以创建多个集合

3、一个集合可以包括多个文档。

#### 5.7.2 应用场景

a) 网站数据：mongo非常适合实时的插入，更新域查询，并具备网站实时的数据存储所需的复制及高度伸缩性。

b) 缓存：由于性能很高，mongo也适用作为信息基础设施的缓存层。在系统重启之后由mongo搭建的持久化缓存可以避免下层的数据源过载。

c) 大尺寸、低价值的数据：使用传统的关系型数据库存储一些数据时可能会比较贵，在此之前，很多程序员往往会选择传统的文字进行存储。

d) 高性伸缩的场景：mongo非常适合由数十或者数百台服务器组成的数据库。

e) 用于兑现及JSON数据的存储：mongo的BSON数据格式非常适合文档格式化的存储及查询。

f) 重要数据：mysql，一般数据：mongodb，临时数据：memcache

g) 对于关系型数据库而言，mongodb提供了一个更快速的视图view；而对于java程序而言，mongodb可以作为u一个持久化的数组来使用，并且这个持久化的数组还可以支持排序、条件、限制等功能。

h) 将mongo代替mysql的部分功能，主要一个思考点就是：把mongodb当作mysql的一个view（视图）

如mongodb经常用于**评论系统**。针对评论这样数据量大并且价值不高的数据，我们通常采用 MongoDB 来实现存储。

#### 5.7.3 优缺点：

优点：

1） 弱一致性（最终一致），更能保证用户的访问速度。

2） 文档结构的存储方式，能够更快捷的获取数

3） 内置GridFS，高效存储二进制大对象（比如照片和视频）

4） 支持复制集、主备、互为主备、自动分片等特性

5） 动态查询

6） 全索引支持，扩展到内部对象和内嵌数组

缺点：

1）  不支持事务

2）  MongoDB占用空间过大，维护工具不够成熟

#### 5.7.4 常问的面试题：

##### 5.7.4.1为什么要在MongoDB中使用分析器

mongodb中包括了一个可以显示数据库中每个操作性能特点的数据库分析器.通过这个分析器你可以找到比预期慢的查询(或写操作);利用这一信息,比如,可以确定是否需要添加索引.

##### 5.7.4.2 为什么MongoDB的数据文件很大？

MongoDB采用的预分配空间的方式来防止文件碎片。

##### 5.7.4.3 mongodb是否支持事务

MongoDB 4.0的新特性——事务（Transactions）：MongoDB 是不支持事务的，因此开发者在需要用到事务的时候，不得不借用其他工具，在业务代码层面去弥补数据库的不足。

事务和会话(Sessions)关联，一个会话同一时刻只能开启一个事务操作，当一个会话断开，这个会话中的事务也会结束。

##### 5.7.4.4. mongodb 与mysql 的区别？

mongodb的本质还是一个数据库产品，3.0以上版本其稳定性和健壮性有很大提升。它与mysql的区别在于它不会遵循一些约束，比如：sql标准、ACID属性，表结构等。其主要特性如下：

 面向集合文档的存储：适合存储Bson（json的扩展）形式的数据；

 格式自由，数据格式不固定，生产环境下修改结构都可以不影响程序运行；

 强大的查询语句，面向对象的查询语言，基本覆盖sql语言所有能力；

 完整的索引支持，支持查询计划；

 支持复制和自动故障转移；

 支持二进制数据及大型对象（文件）的高效存储；

 使用分片集群提升系统扩展性；

 使用内存映射存储引擎，把磁盘的IO操作转换成为内存的操作；

##### 5.7.4.5  GirdFS是什么？工作原理是什么？如何使用？

GridFS是MongoDB提供的用于持久化存储文件的模块，它可以作为分布式文件系统使用，CMS子系统将页面文件、模板文件存储到GridFS中，由于本项目使用MongoDB，选用GridFS可以快速集成开发。

它的工作原理是：

在GridFS存储文件是将文件分块存储，文件会按照256KB的大小分割成多个块进行存储，GridFS使用两个集合（collection）存储文件，一个集合是chunks, 用于存储文件的二进制数据；一个集合是ﬁles，用于存储文件的元数据信息（文件名称、块大小、上传时间等信息）。从GridFS中读取文件要对文件的各各块进行组装、合并。

 

![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg)

 

 

 

 

 

 

 

 

 

 

使用方法是：

使用Spring data mongodb包下提供的GridFsTemplate访问GirdFS。

 

|      |                                                              |
| ---- | ------------------------------------------------------------ |
|      | ![img](file:///C:/Users/79287/AppData/Local/Temp/msohtmlclip1/01/clip_image007.gif) |