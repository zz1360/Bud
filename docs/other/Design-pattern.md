# 设计模式

### 设计模式简介

设计模式（Design Pattern）是前辈们对代码开发经验的总结，是解决特定问题的一系列套路。它不是语法规定，而是一套用来提高代码***可复用性、可维护性、可读性、稳健性以及安全性***的解决方案。

1995 年，GoF（Gang of Four，四人组/四人帮）合作出版了《设计模式：可复用面向对象软件的基础》一书，共收录了 23 种设计模式，从此树立了软件设计模式领域的里程碑，人称「GoF设计模式」。

这 23 种设计模式的本质是面向对象设计原则的实际运用，是对类的封装性、继承性和多态性，以及类的关联关系和组合关系的充分理解。

当然，软件设计模式只是一个引导，在实际的软件开发中，必须根据具体的需求来选择：

对于简单的程序，可能写一个简单的算法要比引入某种设计模式更加容易；

但是对于大型项目开发或者框架设计，用设计模式来组织代码显然更好。

<img src="/img/clip_image003.jpg">

### 设计模式6大设计原则

Single Responsibility Principle      ***单一职责原则***

Liskov Substitution Principle       ***里氏替换原则***

Dependence Inversion Principle    ***依赖倒置原则***

Interface Segregation Principle     ***接口隔离原则***

Law of Demeter                ***迪米特法则***

Open Closed Principle           ***开闭原则***

 

单一职责原则：类的设计尽量做到只有一个原因可以引起它的改变

里氏替换原则：只要父类出现的地方子类就可以出现，且替换成子类也不会出现任何错误或者异常

依赖倒置原则：针对接口编程，而不是针对实现编程

接口隔离原则：不要建立臃肿庞大的接口。即接口尽量细化，同时接口中的方法尽量少

迪米特法则： 一个对象应该对其他对象有最少的了解，也就是说一个类要对自己需要耦合或者调用的类知道的最少

开闭原则：  一个软件实体，比如类，模块，函数应该对扩展开放，对修改关闭

 

设计模式属于代码设计层面，需要大量的代码量积累才能有较深入的认知。由于篇幅有限，这里只介绍单例设计模式，其它的不做深入拓展，有兴趣的可以搜索相关资料研究。

### 单例设计模式

单例对象（Singleton）是一种常用的设计模式。在Java 应用中，单例对象能保证在一个JVM 中，该对象只

有一个实例存在。这样的模式有几个好处：

1、某些类创建比较频繁，对于一些大型的对象，这是一笔很大的系统开销。

2、省去了new 操作符，降低了系统内存的使用频率，减轻GC 压力。

3、有些类如交易所的核心交易引擎，控制着交易流程，如果该类可以创建多个的话，系统完全乱了。（比如

一个军队出现了多个司令员同时指挥，肯定会乱成一团），所以只有使用单例模式，才能保证核心交易服务器

独立控制整个流程。

思路：

类构造器私有

持有自己类型的属性

对外提供获取实例的静态方法

**(1)**饿汉模式
 线程安全，比较常用，但容易产生垃圾，因为一开始就初始化（一上来就吃，很饿）

<img src="/img/clip_image005.jpg">

 

**(2)**懒汉模式
 线程不安全，延迟加载（什么时候用什么时候初始化，不用就不初始化，很懒）

<img src="/img/clip_image001.jpg">

 

**(3)**懒汉模式升级-1（加锁判断）

<img src="/img/clip_image007.jpg">

这种方式，每一次都要判断锁，效率极低，不推荐使用

 

**(4)**懒汉模式升级-2（双重锁判断）

<img src="/img/clip_image009.jpg">

双重检查模式，进行了两次的判断，第一次是为了避免不要的实例，第二次是为了进行同步，避免多线程问题。由于singleton=new Singleton()对象的创建在JVM中可能会进行重排序，在多线程访问下存在风险，使用volatile修饰signleton实例变量有效，解决该问题。

 

**(5)**静态内部类单例模式（）

<img src="/img/clip_image012.jpg">

只有第一次调用getInstance方法时，虚拟机才加载 Inner 并初始化instance ，只有一个线程可以获得对象的初始化锁，其他线程无法进行初始化，保证对象的唯一性。目前此方式是所有单例模式中最推荐的模式，但具体还是根据项目选择。

 

**(6)**枚举单例模式

<img src="/img/clip_image014.jpg">

枚举单例模式在《Effective Java》作者推荐我们用的单例模式。默认枚举实例的创建是线程安全的，并且在任何情况下都是单例。

另外单例模式还有静态代码块的写法，其实就是类似饿汉式，这里就不再附上代码。

到这，单例模式基本可以结束了，第（1）种和第（4）种需要掌握。以上可以应付一般的面试。但是如果想要深入研究的话，还是需要一定精力的。比如怎么保证只能由两个（或多个）实例？或者利用反射的暴力破解可以任意创建对象，怎么解决？等等很多问题，需要在以后的工作中慢慢研究。